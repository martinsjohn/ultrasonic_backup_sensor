#include <Ultrasonic.h> //Ultrasonic sensor library
#include <U8glib.h> //OLED Display interfae library
/*
*Author: John Martins
*
* This project involves using a simple HC-SR04 Ultrasonic sensor installed on the back bumper of a car
* to measure distance as a car backs up. 
* This distance (in CM) is displayed on an OLED display (SSD1315 / SSD1306).
* 
* Inspired by upir (Youtube channel) project for backup camera
* 
*
*
*
*/

//initialize OLED display with I2C connection
//Pins for I2C in and out:
// A4 - SDA (data)
// A5 - SCL/SCK (clock)
U8GLIB_SSD1306_128X64 oled(U8G_I2C_OPT_DEV_0 | U8G_I2C_OPT_NO_ACK | U8G_I2C_OPT_FAST); // Fast I2C / TWI




//***********************bitmaps for images***********************//

// 'car', 56x15px
const unsigned char bitmap_car [] PROGMEM = {
	0xc0, 0x40, 0x00, 0x00, 0x00, 0x02, 0x03, 0xc0, 0x8f, 0xff, 0xff, 0xff, 0xf1, 0x03, 0xe0, 0x70, 
	0x00, 0x00, 0x00, 0x0e, 0x07, 0xff, 0x00, 0xff, 0xff, 0xff, 0x00, 0xff, 0xc0, 0xff, 0x00, 0x00, 
	0x00, 0xff, 0x03, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x47, 0xf8, 0x00, 0x00, 0x00, 0x1f, 
	0xe2, 0x47, 0xfc, 0x00, 0x00, 0x00, 0x3f, 0xe2, 0x40, 0x78, 0x00, 0x00, 0x00, 0x1e, 0x02, 0x30, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x1e, 0x01, 0xff, 0xff, 0xff, 0x80, 0x78, 0x07, 0xe2, 0x00, 
	0x00, 0x00, 0x47, 0xe0, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0xbf, 0xff, 0xff, 0xff, 
	0xfd, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 0x06, 0x00
};

// 'sensor_01_a', 32x14px
const unsigned char bitmap_sensor_01_a [] PROGMEM = {
	0x00, 0xc0, 0x00, 0x00, 0x03, 0xf8, 0x00, 0x00, 0x07, 0xff, 0x00, 0x00, 0x07, 0xff, 0xe0, 0x00, 
	0x0f, 0xff, 0xfe, 0x00, 0x0f, 0xff, 0xff, 0xf0, 0x1f, 0xff, 0xff, 0xf0, 0x0f, 0xff, 0xff, 0xe0, 
	0x03, 0xff, 0xff, 0xe0, 0x00, 0x7f, 0xff, 0xe0, 0x00, 0x1f, 0xff, 0xe0, 0x00, 0x03, 0xff, 0xe0, 
	0x00, 0x00, 0x3f, 0xe0, 0x00, 0x00, 0x03, 0xe0
};

// 'sensor_01_a_empty', 32x14px
const unsigned char bitmap_sensor_01_a_empty [] PROGMEM = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

// 'sensor_01_b', 32x16px
const unsigned char bitmap_sensor_01_b [] PROGMEM = {
	0x02, 0x00, 0x00, 0x00, 0x07, 0x80, 0x00, 0x00, 0x07, 0xf0, 0x00, 0x00, 0x0f, 0xfc, 0x00, 0x00, 
	0x0f, 0xff, 0x80, 0x00, 0x1f, 0xff, 0xf8, 0x00, 0x1f, 0xff, 0xff, 0x80, 0x3f, 0xff, 0xff, 0xf8, 
	0x1f, 0xff, 0xff, 0xf8, 0x07, 0xff, 0xff, 0xf8, 0x01, 0xff, 0xff, 0xf8, 0x00, 0x3f, 0xff, 0xf8, 
	0x00, 0x07, 0xff, 0xf0, 0x00, 0x00, 0xff, 0xf0, 0x00, 0x00, 0x0f, 0xf0, 0x00, 0x00, 0x00, 0xf0
};

// 'sensor_01_b_empty', 32x16px
const unsigned char bitmap_sensor_01_b_empty [] PROGMEM = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  
};

// 'sensor_01_c', 32x17px
const unsigned char bitmap_sensor_01_c [] PROGMEM = {
	0x08, 0x00, 0x00, 0x00, 0x0f, 0x00, 0x00, 0x00, 0x1f, 0xc0, 0x00, 0x00, 0x1f, 0xf8, 0x00, 0x00, 
	0x3f, 0xff, 0x00, 0x00, 0x3f, 0xff, 0xe0, 0x00, 0x7f, 0xff, 0xfe, 0x00, 0x7f, 0xff, 0xff, 0xe0, 
	0x7f, 0xff, 0xff, 0xfe, 0x1f, 0xff, 0xff, 0xfe, 0x03, 0xff, 0xff, 0xfc, 0x00, 0xff, 0xff, 0xfc, 
	0x00, 0x1f, 0xff, 0xfc, 0x00, 0x03, 0xff, 0xfc, 0x00, 0x00, 0x3f, 0xfc, 0x00, 0x00, 0x07, 0xfc, 
	0x00, 0x00, 0x00, 0x3c
};

// 'sensor_01_c_empty', 32x17px
const unsigned char bitmap_sensor_01_c_empty [] PROGMEM = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00
};

// 'sensor_01_d', 32x18px
const unsigned char bitmap_sensor_01_d [] PROGMEM = {
	0x20, 0x00, 0x00, 0x00, 0x38, 0x00, 0x00, 0x00, 0x7f, 0x00, 0x00, 0x00, 0x7f, 0xc0, 0x00, 0x00, 
	0xff, 0xf8, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00, 0xff, 0xff, 0xf0, 0x00, 0xff, 0xff, 0xfe, 0x00, 
	0x7f, 0xff, 0xff, 0xf0, 0x3f, 0xff, 0xff, 0xfe, 0x0f, 0xff, 0xff, 0xfe, 0x03, 0xff, 0xff, 0xfe, 
	0x00, 0x7f, 0xff, 0xfe, 0x00, 0x1f, 0xff, 0xfe, 0x00, 0x01, 0xff, 0xfc, 0x00, 0x00, 0x3f, 0xfc, 
	0x00, 0x00, 0x03, 0xfc, 0x00, 0x00, 0x00, 0x1c
};

// 'sensor_01_d_empty', 32x18px
const unsigned char bitmap_sensor_01_d_empty [] PROGMEM = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};


// 'sensor_02_a', 32x9px
const unsigned char bitmap_sensor_02_a [] PROGMEM = {
	0x07, 0xff, 0xff, 0xc0, 0x0f, 0xff, 0xff, 0xe0, 0x0f, 0xff, 0xff, 0xe0, 0x0f, 0xff, 0xff, 0xe0, 
	0x0f, 0xff, 0xff, 0xe0, 0x0f, 0xff, 0xff, 0xe0, 0x0f, 0xff, 0xff, 0xe0, 0x0f, 0xff, 0xff, 0xe0, 
	0x1f, 0xff, 0xff, 0xf0
};

// 'sensor_02_a_empty', 32x9px
const unsigned char bitmap_sensor_02_a_empty [] PROGMEM = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00
};

// 'sensor_02_b', 32x9px
const unsigned char bitmap_sensor_02_b [] PROGMEM = {
	0x1f, 0xff, 0xff, 0xf0, 0x1f, 0xff, 0xff, 0xf0, 0x1f, 0xff, 0xff, 0xf0, 0x1f, 0xff, 0xff, 0xf0, 
	0x3f, 0xff, 0xff, 0xf8, 0x3f, 0xff, 0xff, 0xf8, 0x3f, 0xff, 0xff, 0xf8, 0x3f, 0xff, 0xff, 0xf8, 
	0x0f, 0xff, 0xff, 0xe0
};

// 'sensor_02_b_empty', 32x9px
const unsigned char bitmap_sensor_02_b_empty [] PROGMEM = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00
};

// 'sensor_02_c', 32x10px
const unsigned char bitmap_sensor_02_c [] PROGMEM = {
	0x18, 0x00, 0x00, 0x0c, 0x1f, 0xff, 0xff, 0xfc, 0x3f, 0xff, 0xff, 0xfe, 0x3f, 0xff, 0xff, 0xfe, 
	0x3f, 0xff, 0xff, 0xfe, 0x3f, 0xff, 0xff, 0xfe, 0x3f, 0xff, 0xff, 0xfe, 0x3f, 0xff, 0xff, 0xfe, 
	0x3f, 0xff, 0xff, 0xfe, 0x0f, 0xff, 0xff, 0xf8
};

// 'sensor_02_c_empty', 32x10px
const unsigned char bitmap_sensor_02_c_empty [] PROGMEM = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

// 'sensor_02_d', 40x10px
const unsigned char bitmap_sensor_02_d [] PROGMEM = {
	0x03, 0x80, 0x00, 0x00, 0x38, 0x03, 0xff, 0xff, 0xff, 0xf8, 0x03, 0xff, 0xff, 0xff, 0xf8, 0x03, 
	0xff, 0xff, 0xff, 0xf8, 0x03, 0xff, 0xff, 0xff, 0xf8, 0x07, 0xff, 0xff, 0xff, 0xfc, 0x07, 0xff, 
	0xff, 0xff, 0xfc, 0x07, 0xff, 0xff, 0xff, 0xfc, 0x07, 0xff, 0xff, 0xff, 0xfc, 0x00, 0xff, 0xff, 
	0xff, 0xe0
};

// 'sensor_02_d_empty', 40x10px
const unsigned char bitmap_sensor_02_d_empty [] PROGMEM = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  
	0x00, 0x00
};

// 'sensor_03_a', 32x14px
const unsigned char bitmap_sensor_03_a [] PROGMEM = {
	0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x3f, 0x80, 0x00, 0x01, 0xff, 0xc0, 0x00, 0x0f, 0xff, 0xc0, 
	0x00, 0xff, 0xff, 0xe0, 0x1f, 0xff, 0xff, 0xe0, 0x1f, 0xff, 0xff, 0xf0, 0x0f, 0xff, 0xff, 0xe0, 
	0x0f, 0xff, 0xff, 0x80, 0x0f, 0xff, 0xfc, 0x00, 0x0f, 0xff, 0xf0, 0x00, 0x0f, 0xff, 0x80, 0x00, 
	0x0f, 0xf8, 0x00, 0x00, 0x0f, 0x80, 0x00, 0x00
};

// 'sensor_03_a_empty', 32x14px
const unsigned char bitmap_sensor_03_a_empty [] PROGMEM = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

// 'sensor_03_b', 32x16px
const unsigned char bitmap_sensor_03_b [] PROGMEM = {
	0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x01, 0xe0, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x3f, 0xf0, 
	0x00, 0x01, 0xff, 0xf0, 0x00, 0x1f, 0xff, 0xf8, 0x01, 0xff, 0xff, 0xf8, 0x1f, 0xff, 0xff, 0xfc, 
	0x1f, 0xff, 0xff, 0xf8, 0x1f, 0xff, 0xff, 0xe0, 0x1f, 0xff, 0xff, 0x80, 0x1f, 0xff, 0xfc, 0x00, 
	0x0f, 0xff, 0xe0, 0x00, 0x0f, 0xff, 0x00, 0x00, 0x0f, 0xf0, 0x00, 0x00, 0x0f, 0x00, 0x00, 0x00
};

// 'sensor_03_b_empty', 32x16px
const unsigned char bitmap_sensor_03_b_empty [] PROGMEM = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
};

// 'sensor_03_c', 32x17px
const unsigned char bitmap_sensor_03_c [] PROGMEM = {
	0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0xf0, 0x00, 0x00, 0x03, 0xf8, 0x00, 0x00, 0x1f, 0xf8, 
	0x00, 0x00, 0xff, 0xfc, 0x00, 0x07, 0xff, 0xfc, 0x00, 0x7f, 0xff, 0xfe, 0x07, 0xff, 0xff, 0xfe, 
	0x7f, 0xff, 0xff, 0xfe, 0x7f, 0xff, 0xff, 0xf8, 0x3f, 0xff, 0xff, 0xc0, 0x3f, 0xff, 0xff, 0x00, 
	0x3f, 0xff, 0xf8, 0x00, 0x3f, 0xff, 0xc0, 0x00, 0x3f, 0xfc, 0x00, 0x00, 0x3f, 0xe0, 0x00, 0x00, 
	0x3c, 0x00, 0x00, 0x00
};

// 'sensor_03_c_empty', 32x17px
const unsigned char bitmap_sensor_03_c_empty [] PROGMEM = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00
};

// 'sensor_03_d', 32x18px
const unsigned char bitmap_sensor_03_d [] PROGMEM = {
	0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x38, 0x00, 0x00, 0x01, 0xfc, 0x00, 0x00, 0x07, 0xfc, 
	0x00, 0x00, 0x3f, 0xfe, 0x00, 0x01, 0xff, 0xfe, 0x00, 0x1f, 0xff, 0xfe, 0x00, 0xff, 0xff, 0xfe, 
	0x1f, 0xff, 0xff, 0xfc, 0xff, 0xff, 0xff, 0xf8, 0xff, 0xff, 0xff, 0xe0, 0xff, 0xff, 0xff, 0x80, 
	0xff, 0xff, 0xfc, 0x00, 0xff, 0xff, 0xf0, 0x00, 0x7f, 0xff, 0x00, 0x00, 0x7f, 0xf8, 0x00, 0x00, 
	0x7f, 0x80, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00
};

// 'sensor_03_d_empty', 32x18px
const unsigned char bitmap_sensor_03_d_empty [] PROGMEM = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

// 'unit_cm', 24x10px
const unsigned char bitmap_unit_cm [] PROGMEM = {
	0xf0, 0x03, 0xc0, 0x80, 0x00, 0x40, 0xbe, 0xff, 0x40, 0xb6, 0xdb, 0x40, 0x30, 0xdb, 0x00, 0x30, 
	0xdb, 0x00, 0xb6, 0xdb, 0x40, 0xbe, 0xdb, 0x40, 0x80, 0x00, 0x40, 0xf0, 0x03, 0xc0
};




/*
  Fontname: gamer_digits
  Copyright: Created with Fony 1.4.7 by upir
  Capital A Height: 0, '1' Height: 6
  Calculated Max Values w= 5 h= 6 x= 1 y= 0 dx= 6 dy= 0 ascent= 0 len= 6
  Font Bounding box     w= 9 h= 5 x= 0 y=-6
  Calculated Min Values           x= 0 y=-6 dx= 0 dy= 0
  Pure Font   ascent = 6 descent= 0
  X Font      ascent = 6 descent= 0
  Max Font    ascent = 0 descent=-6
*/
const u8g_fntpgm_uint8_t gamer_digits[137] U8G_FONT_SECTION("gamer_digits") = {
  0,9,5,0,250,6,0,0,0,0,48,57,0,0,250,6,
  0,5,6,6,6,0,250,248,216,216,216,216,248,4,6,6,
  6,1,250,224,96,96,96,96,240,5,6,6,6,0,250,248,
  24,120,192,192,248,5,6,6,6,0,250,248,24,248,24,216,
  248,5,6,6,6,0,250,56,120,216,248,24,24,5,6,6,
  6,0,250,248,192,248,24,24,248,5,6,6,6,0,250,248,
  192,248,216,216,248,5,6,6,6,0,250,248,24,24,24,24,
  24,5,6,6,6,0,250,248,216,248,216,216,248,5,6,6,
  6,0,250,248,216,216,248,24,248};



//number of ultrasound sensors --> for now starting with 1 central one and maybe adding more
#define NUMBER_OF_ULTRASOUNDS 3


//defining pins for each ultrasound sensor
#define ultrasound_00_TRIG 12
#define ultrasound_00_ECHO 13

#define ultrasound_01_TRIG 10
#define ultrasound_01_ECHO 11

#define ultrasound_02_TRIG 8
#define ultrasound_02_ECHO 9


//struct for each sensor holding all pertinent data of measurement and for display
struct sensor_data{
  int trig_pin; // TRIG pin 
  int echo_pin; // ECHO pin
  int distance; // currently measured distance from the ultrasonic sensor
  int label_x; // current x position of distance label for display
  int label_y; // current y position of distance label for display
  int label_width; // width of distance label (string length) for display
  int label_start_x; // start x position of distance label
  int label_start_y; // start y position of distance label
  int label_end_x; // end x position of distance label
  int label_end_y; // end y position of distance label
};

//helper array to store integers being converted to strings for display
char dist_buffer[10];

//initialize the array of structs --> this will be the main housing of all our sensor data
struct sensor_data sensor[NUMBER_OF_ULTRASOUNDS];

int min_dist = 2; //minimum of 2cm distance to display
int max_dist = 80; //maximum of 100cm distance to display

//initialize ultrasonic sensor with TRIG pin 12, ECHO pin 13
Ultrasonic ultrasound_00(ultrasound_00_TRIG, ultrasound_00_ECHO);
Ultrasonic ultrasound_01(ultrasound_01_TRIG, ultrasound_01_ECHO);
Ultrasonic ultrasound_02(ultrasound_02_TRIG, ultrasound_02_ECHO);

int dist_step_01;
int dist_step_02;
int dist_step_03;
int dist_step_04;

void setup() {
  // put your setup code here, to run once:

  //initialize struct for sensor 1 with pin info
  sensor[0].trig_pin = ultrasound_00_TRIG;
  sensor[0].echo_pin = ultrasound_00_ECHO;

  //set proper pinmodes for each pin
  pinMode(sensor[0].trig_pin, OUTPUT);
  pinMode(sensor[0].echo_pin, INPUT);

  //initialize struct for sensor 1 with pin info
  sensor[1].trig_pin = ultrasound_01_TRIG;
  sensor[1].echo_pin = ultrasound_01_ECHO;

  //set proper pinmodes for each pin
  pinMode(sensor[1].trig_pin, OUTPUT);
  pinMode(sensor[1].echo_pin, INPUT);

  //initialize struct for sensor 1 with pin info
  sensor[2].trig_pin = ultrasound_02_TRIG;
  sensor[2].echo_pin = ultrasound_02_ECHO;

  //set proper pinmodes for each pin
  pinMode(sensor[2].trig_pin, OUTPUT);
  pinMode(sensor[2].echo_pin, INPUT);

  //set font of display
  oled.setFont(gamer_digits);
  
  //set color to white
  oled.setColorIndex(1);
  
  dist_step_01 = min_dist + round((max_dist - min_dist) / 4.0 * 0);
  dist_step_02 = min_dist + round((max_dist - min_dist) / 4.0 * 1.0);
  dist_step_03 = min_dist + round((max_dist - min_dist) / 4.0 * 2.0);
  dist_step_04 = min_dist + round((max_dist - min_dist) / 4.0 * 3.0);

  //Initialize positions of labels for each sensor
  sensor[0].label_start_x = 41;
  sensor[0].label_start_y = 20;
  sensor[0].label_end_x = 30;
  sensor[0].label_end_y = 58;
  sensor[1].label_start_x = 63;
  sensor[1].label_start_y = 23;
  sensor[1].label_end_x = 63;
  sensor[1].label_end_y = 60;
  sensor[2].label_start_x = 85;
  sensor[2].label_start_y = 20;
  sensor[2].label_end_x = 97;
  sensor[2].label_end_y = 57;



  //initialize serial output for IDE / debugging
  Serial.begin(115200);
}

void loop() {
  // put your main code here, to run repeatedly:

  //loop through all sensors to make corresponding readings
  for (int i = 0; i < NUMBER_OF_ULTRASOUNDS; i++){
    
    //read distance and write to proper ultrasound struct
    //sensor[i].distance = ultrasound_01.read();

    sensor[i].distance = i == 0 ? ultrasound_00.read() : i == 1 ? ultrasound_01.read() : ultrasound_02.read();

    itoa(sensor[i].distance, dist_buffer, 10); //convert sensor reading integer to string
    sensor[i].label_width = oled.getStrWidth(dist_buffer); //store label width in struct

    //calculate label positions
    sensor[i].label_x = map(constrain(sensor[i].distance, min_dist, max_dist), min_dist, max_dist, sensor[i].label_start_x, sensor[i].label_end_x);
    sensor[i].label_y = map(constrain(sensor[i].distance, min_dist, max_dist), min_dist, max_dist, sensor[i].label_start_y, sensor[i].label_end_y);



    Serial.print("Distance in CM: ");
    Serial.println(sensor[i].distance);
    delay(50);




  }

  oled.firstPage();
  do{
    oled.drawBitmapP( 36, 0, 56/8, 15, bitmap_car); // car image on top of the display
    
    //Sensor 0 LEFT
    oled.drawBitmapP( 24, 17, 32/8, 14, sensor[0].distance > dist_step_01 ? bitmap_sensor_01_a: bitmap_sensor_01_a_empty);        
    oled.drawBitmapP( 21, 25, 32/8, 16, sensor[0].distance > dist_step_02 ? bitmap_sensor_01_b: bitmap_sensor_01_b_empty);        
    oled.drawBitmapP( 18, 34, 32/8, 17, sensor[0].distance > dist_step_03 ? bitmap_sensor_01_c: bitmap_sensor_01_c_empty);        
    oled.drawBitmapP( 16, 43, 32/8, 18, sensor[0].distance > dist_step_04 ? bitmap_sensor_01_d: bitmap_sensor_01_d_empty);

    //Sensor 1 MIDDLE
     oled.drawBitmapP( 48, 23, 32/8,  9, sensor[1].distance > dist_step_01 ? bitmap_sensor_02_a: bitmap_sensor_02_a_empty);        
     oled.drawBitmapP( 48, 33, 32/8,  9, sensor[1].distance > dist_step_02 ? bitmap_sensor_02_b: bitmap_sensor_02_b_empty);        
     oled.drawBitmapP( 47, 42, 32/8, 10, sensor[1].distance > dist_step_03 ? bitmap_sensor_02_c: bitmap_sensor_02_c_empty);        
     oled.drawBitmapP( 42, 52, 40/8, 10, sensor[1].distance > dist_step_04 ? bitmap_sensor_02_d: bitmap_sensor_02_d_empty);

    //Sensor 2 RIGHT
     oled.drawBitmapP( 72, 17, 32/8, 14, sensor[2].distance > dist_step_01 ? bitmap_sensor_03_a: bitmap_sensor_03_a_empty);        
     oled.drawBitmapP( 74, 25, 32/8, 16, sensor[2].distance > dist_step_02 ? bitmap_sensor_03_b: bitmap_sensor_03_b_empty);        
     oled.drawBitmapP( 77, 34, 32/8, 17, sensor[2].distance > dist_step_03 ? bitmap_sensor_03_c: bitmap_sensor_03_c_empty);        
     oled.drawBitmapP( 80, 43, 32/8, 18, sensor[2].distance > dist_step_04 ? bitmap_sensor_03_d: bitmap_sensor_03_d_empty);


    for(int i = 0; i < NUMBER_OF_ULTRASOUNDS; i++){
      oled.setColorIndex(0); //set color to black to draw background of label
      
      oled.drawBox((sensor[i].label_x - sensor[i].label_width/2) - 1, sensor[i].label_y - 4, sensor[i].label_width + 2, 8); //draw box under label

      itoa(sensor[i].distance, dist_buffer, 10); //convert sensor reading integer to string
      oled.setColorIndex(1); // back to white to draw label

      oled.drawStr(sensor[i].label_x - sensor[i].label_width/2, sensor[i].label_y - 3, dist_buffer); //draw actual label
    }
  } while(oled.nextPage());


}
